<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="es"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../jacoco-resources/report.gif" type="image/gif"/><title>Person.java</title><link rel="stylesheet" href="../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">elis-core</a> &gt; <a href="index.source.html" class="el_package">co.com.elis.core.person</a> &gt; <span class="el_source">Person.java</span></div><h1>Person.java</h1><pre class="source lang-java linenums">/**********************************************************************************************
 *
 * ELectronic Invoicing System Community Core library
 * Copyright (C) 2017-2018. Smart IT S.A.S. &lt;smartit.net.co&gt;
 *
 * This file is licensed under the GNU Affero General Public License version 3 as published by
 * the Free Software Foundation.
 *
 * Unless required by applicable law or agreed to in writing, software distributed under the
 * License is distributed on an &quot;AS IS&quot; BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND,
 * either express or implied. See the License for the specific language governing permissions
 * and limitations under the License.
 *
 * You should have received a copy of the GNU Affero General Public License.  If not, please
 * visit &lt;http://www.gnu.org/licenses/agpl-3.0.html&gt;.
 *
 **********************************************************************************************/

package co.com.elis.core.person;

import co.com.elis.core.document.PhysicalLocation;
import co.com.elis.core.util.ResourceInterpolator;
import co.com.elis.exception.ElisCoreException;
import java.util.ArrayList;
import java.util.List;
import java.util.Set;
import javax.validation.ConstraintViolation;
import javax.validation.Valid;
import javax.validation.Validation;
import javax.validation.Validator;
import javax.validation.constraints.NotNull;
import lombok.Getter;

public abstract class Person&lt;N extends PersonName&gt; {

<span class="fc" id="L36">    @Getter</span>
    @Valid
    @NotNull(message = &quot;ELIS_CORE_VAL_PERSON_DOC&quot;)
    private final IdentityDocument identityDocument;

    @Valid
<span class="fc" id="L42">    @Getter</span>
    @NotNull(message = &quot;ELIS_CORE_UNKNOWN&quot;)
    private final DIANCharacterization dianCharacterization;

<span class="fc" id="L46">    @Getter</span>
    @Valid
    @NotNull(message = &quot;ELIS_CORE_VAL_PERSON_LOCATION&quot;)
    private final PhysicalLocation physicalLocation;

    @Valid
<span class="fc" id="L52">    @Getter</span>
    private final N name;

<span class="fc" id="L55">    @Getter</span>
    @NotNull(message = &quot;ELIS_CORE_UNKNOWN&quot;)
    private final PersonType personType;

<span class="fc" id="L59">    @Getter</span>
    private final List&lt;Contact&gt; contacts;

<span class="fc" id="L62">    protected Person(PersonType personType, N name, IdentityDocument document, PhysicalLocation physicalLocation, DIANCharacterization dianCharacterization, List&lt;Contact&gt; contacts) {</span>
<span class="fc" id="L63">        this.identityDocument = document;</span>
<span class="fc" id="L64">        this.physicalLocation = physicalLocation;</span>
<span class="fc" id="L65">        this.dianCharacterization = dianCharacterization;</span>
<span class="fc" id="L66">        this.personType = personType;</span>
<span class="fc" id="L67">        this.name = name;</span>
<span class="fc" id="L68">        this.contacts = contacts;</span>
<span class="fc" id="L69">    }</span>

    public boolean isJuridicPerson() {
<span class="fc bfc" id="L72" title="All 2 branches covered.">        return getPersonType() == PersonType.JURIDIC;</span>
    }

    public boolean isNaturalPerson() {
<span class="fc bfc" id="L76" title="All 2 branches covered.">        return getPersonType() == PersonType.NATURAL;</span>
    }

    void validateOrThrow() throws ElisCoreException {
<span class="fc" id="L80">        Validator validator = Validation.buildDefaultValidatorFactory().usingContext().messageInterpolator(new ResourceInterpolator()).getValidator();</span>
<span class="fc" id="L81">        Set&lt;ConstraintViolation&lt;Person&lt;N&gt;&gt;&gt; violations = validator.validate(this);</span>

<span class="fc bfc" id="L83" title="All 2 branches covered.">        if (!violations.isEmpty()) {</span>
<span class="fc" id="L84">            ConstraintViolation&lt;Person&lt;N&gt;&gt; violation = violations.iterator().next();</span>
<span class="fc" id="L85">            throw new ElisCoreException(violation.getPropertyPath().toString() + &quot;: &quot; + violation.getMessage());</span>
        }
<span class="fc" id="L87">    }</span>

    public abstract static class PersonBuilder&lt;N extends PersonName, R extends RepresentationType, C extends PersonBuilder&gt; {

        protected PhysicalLocation physicalLocation;
        protected IdentityDocument identityDocument;
        protected boolean naturalPerson;
        protected List&lt;Obligation&gt; obligations;
        protected List&lt;CustomUserCode&gt; customUserCodes;
        protected List&lt;EstablishmentType&gt; establishmentTypes;
        protected List&lt;RepresentationType&gt; representationTypes;
        protected List&lt;Contact&gt; contacts;
        protected N personName;
        protected PersonType personType;
        protected boolean disableValidations;

<span class="fc" id="L103">        public PersonBuilder(PersonType personType) {</span>
<span class="fc" id="L104">            obligations = new ArrayList&lt;&gt;();</span>
<span class="fc" id="L105">            customUserCodes = new ArrayList&lt;&gt;();</span>
<span class="fc" id="L106">            establishmentTypes = new ArrayList&lt;&gt;();</span>
<span class="fc" id="L107">            representationTypes = new ArrayList&lt;&gt;();</span>
<span class="fc" id="L108">            contacts = new ArrayList&lt;&gt;();</span>
<span class="fc" id="L109">            this.personType = personType;</span>
<span class="fc" id="L110">            this.disableValidations = false;</span>
<span class="fc" id="L111">        }</span>

        /**
         * Assigns a IdentityDocument to the built person
         *
         * @param identityDocument IdentityDocument to be assigned
         * @return chaining builder
         */
        public C withIdentityDocument(IdentityDocument identityDocument) {
<span class="fc" id="L120">            this.identityDocument = identityDocument;</span>
<span class="fc" id="L121">            return collectContext();</span>
        }

        public C addObligation(Obligation obligation) {
<span class="fc" id="L125">            obligations.add(obligation);</span>
<span class="fc" id="L126">            return collectContext();</span>
        }

        public C addObligations(List&lt;Obligation&gt; obligations) {
<span class="nc" id="L130">            this.obligations.addAll(obligations);</span>
<span class="nc" id="L131">            return collectContext();</span>
        }
        
        public C addRepresentationTypes(List&lt;R&gt; representationType) {
<span class="nc" id="L135">            this.representationTypes.addAll(representationType);</span>
<span class="nc" id="L136">            return collectContext();</span>
        }        

        public C addCustomUserCode(CustomUserCode customUserCode) {
<span class="fc" id="L140">            customUserCodes.add(customUserCode);</span>
<span class="fc" id="L141">            return collectContext();</span>
        }

        public C addRepresentationType(R representationType) {
<span class="fc" id="L145">            representationTypes.add(representationType);</span>
<span class="fc" id="L146">            return collectContext();</span>
        }

        public C addEstablishmentType(EstablishmentType establishmentType) {
<span class="fc" id="L150">            establishmentTypes.add(establishmentType);</span>
<span class="fc" id="L151">            return collectContext();</span>
        }
        
        public C addEstablishmentTypes(List&lt;EstablishmentType&gt; establishmentTypes) {
<span class="nc" id="L155">            this.establishmentTypes.addAll(establishmentTypes);</span>
<span class="nc" id="L156">            return collectContext();</span>
        }        

        public C addContacts(List&lt;Contact&gt; contacts) {
<span class="nc" id="L160">            this.contacts.addAll(contacts);</span>
<span class="nc" id="L161">            return collectContext();</span>
        }

        public C addContact(Contact contact) {
<span class="fc" id="L165">            contacts.add(contact);</span>
<span class="fc" id="L166">            return collectContext();</span>
        }

        public C withPhysicalLocation(PhysicalLocation physicalLocation) {
<span class="fc" id="L170">            this.physicalLocation = physicalLocation;</span>
<span class="fc" id="L171">            return collectContext();</span>
        }

        public C disableValidations() {
<span class="nc" id="L175">            this.disableValidations = true;</span>
<span class="nc" id="L176">            return collectContext();</span>
        }

        protected abstract C collectContext();

    }

}
</pre><div class="footer"><span class="right">Created with <a href="http://www.jacoco.org/jacoco">JaCoCo</a> 0.7.9.201702052155</span></div></body></html>